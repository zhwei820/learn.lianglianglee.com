<!DOCTYPE html>

<!-- saved from url=(0046)https://kaiiiz.github.io/hexo-theme-book-demo/ -->

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

    <head>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

        <link rel="icon" href="/static/favicon.png">

        <title>25  固若金汤的根本（下）：数字签名与证书.md.html</title>

        <!-- Spectre.css framework -->

        <link rel="stylesheet" href="/static/index.css">

        <!-- theme css & js -->

        <meta name="generator" content="Hexo 4.2.0">

    </head>
<body>
<div class="book-container">

    <div class="book-sidebar">

        <div class="book-brand">

            <a href="/">

                <img src="/static/favicon.png">

                <span>技术文章摘抄</span>

            </a>

        </div>

        <div class="book-menu uncollapsible">

            <ul class="uncollapsible">

                <li><a href="/" class="current-tab">首页</a></li>

            </ul>
            <ul class="uncollapsible">

                <li><a href="../">上一级</a></li>

            </ul>
            <ul class="uncollapsible">

                <li>
                    

                    <a href="/专栏/透视HTTP协议/00 开篇词｜To Be a HTTP Hero.md.html">00 开篇词｜To Be a HTTP Hero.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/01  时势与英雄：HTTP的前世今生.md.html">01  时势与英雄：HTTP的前世今生.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/02  HTTP是什么？HTTP又不是什么？.md.html">02  HTTP是什么？HTTP又不是什么？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/03  HTTP世界全览（上）：与HTTP相关的各种概念.md.html">03  HTTP世界全览（上）：与HTTP相关的各种概念.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/04  HTTP世界全览（下）：与HTTP相关的各种协议.md.html">04  HTTP世界全览（下）：与HTTP相关的各种协议.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/05  常说的“四层”和“七层”到底是什么？“五层”“六层”哪去了？.md.html">05  常说的“四层”和“七层”到底是什么？“五层”“六层”哪去了？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/06  域名里有哪些门道？.md.html">06  域名里有哪些门道？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/07  自己动手，搭建HTTP实验环境.md.html">07  自己动手，搭建HTTP实验环境.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/08  键入网址再按下回车，后面究竟发生了什么？.md.html">08  键入网址再按下回车，后面究竟发生了什么？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/09  HTTP报文是什么样子的？.md.html">09  HTTP报文是什么样子的？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/10  应该如何理解请求方法？.md.html">10  应该如何理解请求方法？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/11  你能写出正确的网址吗？.md.html">11  你能写出正确的网址吗？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/12  响应状态码该怎么用？.md.html">12  响应状态码该怎么用？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/13  HTTP有哪些特点？.md.html">13  HTTP有哪些特点？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/14  HTTP有哪些优点？又有哪些缺点？.md.html">14  HTTP有哪些优点？又有哪些缺点？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/15  海纳百川：HTTP的实体数据.md.html">15  海纳百川：HTTP的实体数据.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/16  把大象装进冰箱：HTTP传输大文件的方法.md.html">16  把大象装进冰箱：HTTP传输大文件的方法.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/17  排队也要讲效率：HTTP的连接管理.md.html">17  排队也要讲效率：HTTP的连接管理.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/18  四通八达：HTTP的重定向和跳转.md.html">18  四通八达：HTTP的重定向和跳转.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/19  让我知道你是谁：HTTP的Cookie机制.md.html">19  让我知道你是谁：HTTP的Cookie机制.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/20  生鲜速递：HTTP的缓存控制.md.html">20  生鲜速递：HTTP的缓存控制.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/21  良心中间商：HTTP的代理服务.md.html">21  良心中间商：HTTP的代理服务.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/22  冷链周转：HTTP的缓存代理.md.html">22  冷链周转：HTTP的缓存代理.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/23  HTTPS是什么？SSLTLS又是什么？.md.html">23  HTTPS是什么？SSLTLS又是什么？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/24  固若金汤的根本（上）：对称加密与非对称加密.md.html">24  固若金汤的根本（上）：对称加密与非对称加密.md.html</a>
                </li>

                <li>
                    <a class="current-tab" href="/专栏/透视HTTP协议/25  固若金汤的根本（下）：数字签名与证书.md.html">25  固若金汤的根本（下）：数字签名与证书.md.html</a>

                    
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/26  信任始于握手：TLS1.2连接过程解析.md.html">26  信任始于握手：TLS1.2连接过程解析.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/27  更好更快的握手：TLS1.3特性解析.md.html">27  更好更快的握手：TLS1.3特性解析.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/28  连接太慢该怎么办：HTTPS的优化.md.html">28  连接太慢该怎么办：HTTPS的优化.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/29  我应该迁移到HTTPS吗？.md.html">29  我应该迁移到HTTPS吗？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/30  时代之风（上）：HTTP2特性概览.md.html">30  时代之风（上）：HTTP2特性概览.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/31  时代之风（下）：HTTP2内核剖析.md.html">31  时代之风（下）：HTTP2内核剖析.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/32  未来之路：HTTP3展望.md.html">32  未来之路：HTTP3展望.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/33  我应该迁移到HTTP2吗？.md.html">33  我应该迁移到HTTP2吗？.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/34  Nginx：高性能的Web服务器.md.html">34  Nginx：高性能的Web服务器.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/35  OpenResty：更灵活的Web服务器.md.html">35  OpenResty：更灵活的Web服务器.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/36  WAF：保护我们的网络服务.md.html">36  WAF：保护我们的网络服务.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/37  CDN：加速我们的网络服务.md.html">37  CDN：加速我们的网络服务.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/38  WebSocket：沙盒里的TCP.md.html">38  WebSocket：沙盒里的TCP.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/39  HTTP性能优化面面观（上）.md.html">39  HTTP性能优化面面观（上）.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/40  HTTP性能优化面面观（下）.md.html">40  HTTP性能优化面面观（下）.md.html</a>
                </li>

                <li>
                    

                    <a href="/专栏/透视HTTP协议/结束语  做兴趣使然的Hero.md.html">结束语  做兴趣使然的Hero.md.html</a>
                </li>

            </ul>
        </div>

    </div>
    <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">

        <div class="sidebar-toggle-inner"></div>

    </div>
    <script>

        function add_inner() {

            let inner = document.querySelector('.sidebar-toggle-inner')

            inner.classList.add('show')

        }
        function remove_inner() {

            let inner = document.querySelector('.sidebar-toggle-inner')

            inner.classList.remove('show')

        }
        function sidebar_toggle() {

            let sidebar_toggle = document.querySelector('.sidebar-toggle')

            let sidebar = document.querySelector('.book-sidebar')

            let content = document.querySelector('.off-canvas-content')

            if (sidebar_toggle.classList.contains('extend')) { // show

                sidebar_toggle.classList.remove('extend')

                sidebar.classList.remove('hide')

                content.classList.remove('extend')

            } else { // hide

                sidebar_toggle.classList.add('extend')

                sidebar.classList.add('hide')

                content.classList.add('extend')

            }

        }


function open_sidebar() {

    let sidebar = document.querySelector('.book-sidebar')

    let overlay = document.querySelector('.off-canvas-overlay')

    sidebar.classList.add('show')

    overlay.classList.add('show')

}

function hide_canvas() {

    let sidebar = document.querySelector('.book-sidebar')

    let overlay = document.querySelector('.off-canvas-overlay')

    sidebar.classList.remove('show')

    overlay.classList.remove('show')

}
    </script>
    <div class="off-canvas-content">

        <div class="columns">

            <div class="column col-12 col-lg-12">

                <div class="book-navbar">

                    <!-- For Responsive Layout -->

                    <header class="navbar">

                        <section class="navbar-section">

                            <a onclick="open_sidebar()">

                                <i class="icon icon-menu"></i>

                            </a>

                        </section>

                    </header>

                </div>

                <div class="book-content" style="max-width: 960px; margin: 0 auto;

    overflow-x: auto;

    overflow-y: hidden;">

                    <div class="book-post">

                        <p id="tip" align="center"></p>

                        <div><h1>25  固若金汤的根本（下）：数字签名与证书</h1>

<p>上一讲中我们学习了对称加密和非对称加密，以及两者结合起来的混合加密，实现了机密性。</p>

<p>但仅有机密性，离安全还差的很远。</p>

<p>黑客虽然拿不到会话密钥，无法破解密文，但可以通过窃听收集到足够多的密文，再尝试着修改、重组后发给网站。因为没有完整性保证，服务器只能“照单全收”，然后他就可以通过服务器的响应获取进一步的线索，最终就会破解出明文。</p>

<p>另外，黑客也可以伪造身份发布公钥。如果你拿到了假的公钥，混合加密就完全失效了。你以为自己是在和“某宝”通信，实际上网线的另一端却是黑客，银行卡号、密码等敏感信息就在“安全”的通信过程中被窃取了。</p>

<p>所以，在机密性的基础上还必须加上完整性、身份认证等特性，才能实现真正的安全。</p>

<h2>摘要算法</h2>

<p>实现完整性的手段主要是<strong>摘要算法</strong>（Digest Algorithm），也就是常说的散列函数、哈希函数（Hash Function）。</p>

<p>你可以把摘要算法近似地理解成一种特殊的压缩算法，它能够把任意长度的数据“压缩”成固定长度、而且独一无二的“摘要”字符串，就好像是给这段数据生成了一个数字“指纹”。</p>

<p>换一个角度，也可以把摘要算法理解成特殊的“单向”加密算法，它只有算法，没有密钥，加密后的数据无法解密，不能从摘要逆推出原文。</p>

<p><img src="assets/2865d2c77466efb7a480833bcb27f9d8.png" alt="img" /></p>

<p>摘要算法实际上是把数据从一个“大空间”映射到了“小空间”，所以就存在“冲突”（collision，也叫碰撞）的可能性，就如同现实中的指纹一样，可能会有两份不同的原文对应相同的摘要。好的摘要算法必须能够“抵抗冲突”，让这种可能性尽量地小。</p>

<p>因为摘要算法对输入具有“单向性”和“雪崩效应”，输入的微小不同会导致输出的剧烈变化，所以也被 TLS 用来生成伪随机数（PRF，pseudo random function）。</p>

<p>你一定在日常工作中听过、或者用过 MD5（Message-Digest 5）、SHA-1（Secure Hash Algorithm 1），它们就是最常用的两个摘要算法，能够生成 16 字节和 20 字节长度的数字摘要。但这两个算法的安全强度比较低，不够安全，在 TLS 里已经被禁止使用了。</p>

<p>目前 TLS 推荐使用的是 SHA-1 的后继者：SHA-2。</p>

<p>SHA-2 实际上是一系列摘要算法的统称，总共有 6 种，常用的有 SHA224、SHA256、SHA384，分别能够生成 28 字节、32 字节、48 字节的摘要。</p>

<p>你可以用实验环境的 URI“/25-1”来测试一下 TLS 里的各种摘要算法，包括 MD5、SHA-1 和 SHA-2。</p>

<pre><code>https://www.chrono.com/25-1?algo=md5

https://www.chrono.com/25-1?algo=sha1

https://www.chrono.com/25-1?algo=sha256

</code></pre>

<h2>完整性</h2>

<p>摘要算法保证了“数字摘要”和原文是完全等价的。所以，我们只要在原文后附上它的摘要，就能够保证数据的完整性。</p>

<p>比如，你发了条消息：“转账 1000 元”，然后再加上一个 SHA-2 的摘要。网站收到后也计算一下消息的摘要，把这两份“指纹”做个对比，如果一致，就说明消息是完整可信的，没有被修改。</p>

<p>如果黑客在中间哪怕改动了一个标点符号，摘要也会完全不同，网站计算比对就会发现消息被窜改，是不可信的。</p>

<p>不过摘要算法不具有机密性，如果明文传输，那么黑客可以修改消息后把摘要也一起改了，网站还是鉴别不出完整性。</p>

<p>所以，真正的完整性必须要建立在机密性之上，在混合加密系统里用会话密钥加密消息和摘要，这样黑客无法得知明文，也就没有办法动手脚了。</p>

<p>这有个术语，叫哈希消息认证码（HMAC）。</p>

<p><img src="assets/c2e10e9afa1393281b5633b1648f2696.png" alt="img" /></p>

<h2>数字签名</h2>

<p>加密算法结合摘要算法，我们的通信过程可以说是比较安全了。但这里还有漏洞，就是通信的两个端点（endpoint）。</p>

<p>就像一开始所说的，黑客可以伪装成网站来窃取信息。而反过来，他也可以伪装成你，向网站发送支付、转账等消息，网站没有办法确认你的身份，钱可能就这么被偷走了。</p>

<p>现实生活中，解决身份认证的手段是签名和印章，只要在纸上写下签名或者盖个章，就能够证明这份文件确实是由本人而不是其他人发出的。</p>

<p>你回想一下之前的课程，在 TLS 里有什么东西和现实中的签名、印章很像，只能由本人持有，而其他任何人都不会有呢？只要用这个东西，就能够在数字世界里证明你的身份。</p>

<p>没错，这个东西就是非对称加密里的“<strong>私钥</strong>”，使用私钥再加上摘要算法，就能够实现“<strong>数字签名</strong>”，同时实现“身份认证”和“不可否认”。</p>

<p>数字签名的原理其实很简单，就是把公钥私钥的用法反过来，之前是公钥加密、私钥解密，现在是私钥加密、公钥解密。</p>

<p>但又因为非对称加密效率太低，所以私钥只加密原文的摘要，这样运算量就小的多，而且得到的数字签名也很小，方便保管和传输。</p>

<p>签名和公钥一样完全公开，任何人都可以获取。但这个签名只有用私钥对应的公钥才能解开，拿到摘要后，再比对原文验证完整性，就可以像签署文件一样证明消息确实是你发的。</p>

<p><img src="assets/84a79826588ca35bf6ddcade027597d2.png" alt="img" /></p>

<p>刚才的这两个行为也有专用术语，叫做“<strong>签名</strong>”和“<strong>验签</strong>”。</p>

<p>只要你和网站互相交换公钥，就可以用“签名”和“验签”来确认消息的真实性，因为私钥保密，黑客不能伪造签名，就能够保证通信双方的身份。</p>

<p>比如，你用自己的私钥签名一个消息“我是小明”。网站收到后用你的公钥验签，确认身份没问题，于是也用它的私钥签名消息“我是某宝”。你收到后再用它的公钥验一下，也没问题，这样你和网站就都知道对方不是假冒的，后面就可以用混合加密进行安全通信了。</p>

<p>实验环境的 URI“/25-2”演示了 TLS 里的数字签名，它使用的是 RSA1024。</p>

<h2>数字证书和 CA</h2>

<p>到现在，综合使用对称加密、非对称加密和摘要算法，我们已经实现了安全的四大特性，是不是已经完美了呢？</p>

<p>不是的，这里还有一个“<strong>公钥的信任</strong>”问题。因为谁都可以发布公钥，我们还缺少防止黑客伪造公钥的手段，也就是说，怎么来判断这个公钥就是你或者某宝的公钥呢？</p>

<p>真是“按下葫芦又起了瓢”，安全还真是个麻烦事啊，“一环套一环”的。</p>

<p>我们可以用类似密钥交换的方法来解决公钥认证问题，用别的私钥来给公钥签名，显然，这又会陷入“无穷递归”。</p>

<p>但这次实在是“没招”了，要终结这个“死循环”，就必须引入“外力”，找一个公认的可信第三方，让它作为“信任的起点，递归的终点”，构建起公钥的信任链。</p>

<p>这个“第三方”就是我们常说的<strong>CA</strong>（Certificate Authority，证书认证机构）。它就像网络世界里的公安局、教育部、公证中心，具有极高的可信度，由它来给各个公钥签名，用自身的信誉来保证公钥无法伪造，是可信的。</p>

<p>CA 对公钥的签名认证也是有格式的，不是简单地把公钥绑定在持有者身份上就完事了，还要包含序列号、用途、颁发者、有效时间等等，把这些打成一个包再签名，完整地证明公钥关联的各种信息，形成“<strong>数字证书</strong>”（Certificate）。</p>

<p>知名的 CA 全世界就那么几家，比如 DigiCert、VeriSign、Entrust、Let’s Encrypt 等，它们签发的证书分 DV、OV、EV 三种，区别在于可信程度。</p>

<p>DV 是最低的，只是域名级别的可信，背后是谁不知道。EV 是最高的，经过了法律和审计的严格核查，可以证明网站拥有者的身份（在浏览器地址栏会显示出公司的名字，例如 Apple、GitHub 的网站）。</p>

<p>不过，CA 怎么证明自己呢？</p>

<p>这还是信任链的问题。小一点的 CA 可以让大 CA 签名认证，但链条的最后，也就是<strong>Root CA</strong>，就只能自己证明自己了，这个就叫“<strong>自签名证书</strong>”（Self-Signed Certificate）或者“<strong>根证书</strong>”（Root Certificate）。你必须相信，否则整个证书信任链就走不下去了。</p>

<p><img src="assets/8f0813e9555ba1a40bd2170734aced9c.png" alt="img" /></p>

<p>有了这个证书体系，操作系统和浏览器都内置了各大 CA 的根证书，上网的时候只要服务器发过来它的证书，就可以验证证书里的签名，顺着证书链（Certificate Chain）一层层地验证，直到找到根证书，就能够确定证书是可信的，从而里面的公钥也是可信的。</p>

<p>我们的实验环境里使用的证书是“野路子”的自签名证书（在 Linux 上用 OpenSSL 命令行签发），肯定是不会被浏览器所信任的，所以用 Chrome 访问时就会显示成红色，标记为不安全。但你只要把它安装进系统的根证书存储区里，让它作为信任链的根，就不会再有危险警告。</p>

<p><img src="assets/a55051ca7ae941ae04791cdddde6658f.png" alt="img" /></p>

<h2>证书体系的弱点</h2>

<p>证书体系（PKI，Public Key Infrastructure）虽然是目前整个网络世界的安全基础设施，但绝对的安全是不存在的，它也有弱点，还是关键的“<strong>信任</strong>”二字。</p>

<p>如果 CA 失误或者被欺骗，签发了错误的证书，虽然证书是真的，可它代表的网站却是假的。</p>

<p>还有一种更危险的情况，CA 被黑客攻陷，或者 CA 有恶意，因为它（即根证书）是信任的源头，整个信任链里的所有证书也就都不可信了。</p>

<p>这两种事情并不是“耸人听闻”，都曾经实际出现过。所以，需要再给证书体系打上一些补丁。</p>

<p>针对第一种，开发出了 CRL（证书吊销列表，Certificate revocation list）和 OCSP（在线证书状态协议，Online Certificate Status Protocol），及时废止有问题的证书。</p>

<p>对于第二种，因为涉及的证书太多，就只能操作系统或者浏览器从根上“下狠手”了，撤销对 CA 的信任，列入“黑名单”，这样它颁发的所有证书就都会被认为是不安全的。</p>

<h2>小结</h2>

<p>今天我们学习了数字签名和证书、CA，是不是有种“盗梦空间”一层套一层的感觉？你可以在课后再去各大网站，结合它们“小锁头”里的信息来加深理解。</p>

<p>今天的内容可以简单概括为四点：</p>

<ol>

<li>摘要算法用来实现完整性，能够为数据生成独一无二的“指纹”，常用的算法是 SHA-2；</li>

<li>数字签名是私钥对摘要的加密，可以由公钥解密后验证，实现身份认证和不可否认；</li>

<li>公钥的分发需要使用数字证书，必须由 CA 的信任链来验证，否则就是不可信的；</li>

<li>作为信任链的源头 CA 有时也会不可信，解决办法有 CRL、OCSP，还有终止信任。</li>

</ol>

<h2>课下作业</h2>

<ol>

<li>为什么公钥能够建立信任链，用对称加密算法里的对称密钥行不行呢？</li>

<li>假设有一个三级的证书体系（Root CA=&gt; 一级 CA=&gt; 二级 CA），你能详细解释一下证书信任链的验证过程吗？</li>

</ol>

<p>欢迎你把自己的学习体会写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p>

<p><img src="assets/37c59439c36e75f610fe84c22009cc57.png" alt="img" /></p>

</div>

                    </div>

                    <div>

                        <div style="float: left">

                            <a href="/专栏/透视HTTP协议/24  固若金汤的根本（上）：对称加密与非对称加密.md.html">上一页</a>

                        </div>

                        <div style="float: right">

                            <a href="/专栏/透视HTTP协议/26  信任始于握手：TLS1.2连接过程解析.md.html">下一页</a>

                        </div>

                    </div>
                </div>

            </div>

        </div>

    </div>
    <a class="off-canvas-overlay" onclick="hide_canvas()"></a>

</div>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js/v652eace1692a40cfa3763df669d7439c1639079717194" integrity="sha512-Gi7xpJR8tSkrpF7aordPZQlW2DLtzUlZcumS8dMQjwDHEnw9I7ZLyiOj/6tZStRBGtGgN6ceN6cMH8z7etPGlw==" data-cf-beacon='{"rayId":"70997d171c673cfa","version":"2021.12.0","r":1,"token":"1f5d475227ce4f0089a7cff1ab17c0f5","si":100}' crossorigin="anonymous"></script>

</body>

<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>

<script>

    window.dataLayer = window.dataLayer || [];
    function gtag() {

        dataLayer.push(arguments);

    }
    gtag('js', new Date());

    gtag('config', 'G-NPSEEVD756');

    var path = window.location.pathname

    var cookie = getCookie("lastPath");

    console.log(path)

    if (path.replace("/", "") === "") {

        if (cookie.replace("/", "") !== "") {

            console.log(cookie)

            document.getElementById("tip").innerHTML = "<a href='" + cookie + "'>跳转到上次进度</a>"

        }

    } else {

        setCookie("lastPath", path)

    }
    function setCookie(cname, cvalue) {

        var d = new Date();

        d.setTime(d.getTime() + (180 * 24 * 60 * 60 * 1000));

        var expires = "expires=" + d.toGMTString();

        document.cookie = cname + "=" + cvalue + "; " + expires + ";path = /";

    }
    function getCookie(cname) {

        var name = cname + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i].trim();

            if (c.indexOf(name) === 0) return c.substring(name.length, c.length);

        }

        return "";

    }
</script>
</html>

